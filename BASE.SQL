CREATE DATABASE SISTEMA_FACT;

USE SISTEMA_FACT;

CREATE TABLE CLIENTE(
    CLIE_CEDULA CHAR(10),
    CLIE_NOMBRE VARCHAR(50) NOT NULL,
    CLIE_CORREO VARCHAR(50), 
    CLIE_TELEFONO CHAR(10), 
    CLIE_DIRECCION VARCHAR(50), 
    CONSTRAINT PK_CLIENTE PRIMARY KEY(CLIE_CEDULA)
);

CREATE TABLE VENDEDOR(
    VEN_CEDULA CHAR(10), 
    VEN_NOMBRE VARCHAR(50) NOT NULL, 
    VEN_TELEFONO CHAR(10), 
    CONSTRAINT PK_VENDEDOR PRIMARY KEY (VEN_CEDULA)
);

CREATE TABLE PRODUCTO(
    PROD_CODIGO CHAR(6), 
    PROD_REFERENCIA CHAR(12) UNIQUE,
    PROD_NOMBRE VARCHAR(50) NOT NULL, 
    PROD_PRECIO FLOAT NOT NULL, 
    PROD_UNIDADES INTEGER DEFAULT 1, 
    PROD_STOCK INTEGER DEFAULT 0,  
    CONSTRAINT PK_PRODUCTO PRIMARY KEY(PROD_CODIGO)
);

CREATE TABLE CAJA(
    CAJA_NUMERO INTEGER AUTO_INCREMENT, 
    CAJA_DINERO_INICIA FLOAT NOT NULL, 
    CAJA_FECHA_INI DATATIME NOT NULL,
    CAJA_VENTA_EFECT FLOAT DEFAULT 0.0, 
    CAJA_ARQUEO FLOAT DEFAULT 0.0, 
    CAJA_VALES FLOAT DEFAULT 0.0, 
    VEN_CEDULA CHAR(10), 
    CONSTRAINT PK_CAJA_NUMERO PRIMARY KEY (CAJA_NUMERO), 
    CONSTRAINT FK_CAJA_VEN_CEDULA FOREIGN KEY(VEN_CEDULA) REFERENCES VENDEDOR(VEN_CEDULA)
);

CREATE TABLE TRANSACCIONES(
    TRANS_ID_TRANSACCIONES INTEGER AUTO_INCREMENT, 
    TRANS_N_DEVOLUCIONES INTEGER AUTO_INCREMENT, 
    TRANS_N_LEGALIZACION INTEGER AUTO_INCREMENT, 
    TRANS_N_LC INTEGER AUTO_INCREMENT, 
    TRANS_FECHA DATATIME NOT NULL, 
    TRANS_TOTAL FLOAT NOT NULL, 
    VEN_CEDULA CHAR(10), 
    CLIE_CEDULA CHAR(10), 
    CONSTRAINT PK_TRANS_ID_TRANSACCION PRIMARY KEY (TRANS_ID_TRANSACCIONES), 
    CONSTRAINT FK_TRANS_VEN_CEDULA FOREIGN KEY(VEN_CEDULA) REFERENCES VENDEDOR(VEN_CEDULA), 
    CONSTRAINT FK_TRANS_CLIE_CEDULA FOREIGN KEY(CLIE_CEDULA) REFERENCES CLIENTE(CLIE_CEDULA)
);

CREATE TABLE TRANSACCION_PRODUCTO(
    TRANS_ID INTEGER, 
    PROD_CODIGO CHAR(6), 
    TRANS_PROD_CANTIDAD INTEGER NOT NULL,
    TRANS_PROD_TIPO CHAR(1) CHECK (TRANS_PROD_TIPO = 'E' OR TRANS_PROD_TIPO = 'S'), 
    CONSTRAINT PK_TRANS_PROD PRIMARY KEY(TRANS_ID, PROD_CODIGO), 
    CONSTRAINT FK_TRANS_PROD_ID FOREIGN KEY(TRANS_ID) REFERENCES TRANSACCIONES(TRANS_ID_TRANSACCIONES), 
    CONSTRAINT FK_TRANS_PROD_PRODUCTO FOREIGN KEY(PROD_CODIGO) REFERENCES PRODUCTO(PROD_CODIGO)
)
